/*!
otree-front v1.2.0
microframework for interactive pages for oTree platform
(C) qwiglydee@gmail.com
https://github.com/qwiglydee/otree-front
*/
var ot=function(t){"use strict";function e(t){return Array.isArray(t)}function n(t){return null==t||Number.isNaN(t)}function i(t){return Object.prototype.toString.call(t).startsWith("[object HTML")}function o(t){var e=typeof t;return"string"===e||("number"===e||("boolean"===e||("symbol"===e||(null==t||(t instanceof Symbol||(t instanceof String||(t instanceof Number||t instanceof Boolean)))))))}function s(t){return"[object Object]"===Object.prototype.toString.call(t)}function r(t){var e,n;return!1!==s(t)&&(void 0===(e=t.constructor)||!1!==s(n=e.prototype)&&!1!==n.hasOwnProperty("isPrototypeOf"))}function a(t,n){return Array.from(t).every(((t,i)=>function(t,n){switch(n){case"data":return!0;case"array":return e(t);case"object":return s(t);default:return typeof t===n}}(t,n[i])))}function c(t,e){for(var n=arguments.length,i=new Array(n>2?n-2:0),o=2;o<n;o++)i[o-2]=arguments[o];if(0==i.filter((t=>t.length==e.length&&a(e,t))).length){const e=i.map((e=>"".concat(t,"(").concat(e.join(", "),")"))).join(" or ");throw new Error("Invalid arguments, expected: ".concat(e))}}function l(t,e){c("emitEvent",arguments,["string","data"],["string"]);let n=new CustomEvent("ot.".concat(t),{detail:e});setTimeout((()=>document.body.dispatchEvent(n)))}function u(t,e,n){return(e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var i=n.call(t,e||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}const h=/^[a-zA-Z]\w+(\.\w+)*$/;function m(t,e){return e==t||e.startsWith(t+".")}function d(t,e){return m(t,e)||e.endsWith(".*")&&t.startsWith(e.slice(0,-2))}function p(t,e){return e.endsWith(".*")&&(e=e.slice(0,-2)),e.split(".").reduce(((t,e)=>t&&e in t?t[e]:void 0),t)}function f(t,e,n){const i=e.split("."),o=i.slice(0,-1),s=i.slice(-1)[0];let r=o.length?function(t,e){return e.reduce(((t,e)=>t&&e in t?t[e]:void 0),t)}(t,o):t;if(void 0===r)throw new Error("Unreachable keypath ".concat(e));r[s]=n}var v=Object.freeze({__proto__:null,affects:d,extract:p,includes:m,length:function(t){return t.split(".").length},update:function(t,e,n){const i=e.split("."),o=i.slice(0,-1),s=i.slice(-1)[0];let r=o.length?function(t,e){return e.reduce(((t,e)=>t&&e in t?t[e]:void 0),t)}(t,o):t;if(void 0===r)throw new Error("Unreachable keypath ".concat(e));r[s]=n},upsert:f,validate:function(t){return t.match(h)}});function g(t,e){return Array.from(t.keys()).some((t=>d(t,e)))}const b="([a-zA-Z]\\w+(\\.\\w+)*)";class w{static match(t){if(t.match(this.banned))throw new Error("banned expression");let e=t.match(this.regexp);if(!e)throw new Error("invalid expression");return e}affected(t){return g(t,this.var)}value(t){return p(t,this.var)}}u(w,"regexp",new RegExp("^"+b+"$")),u(w,"banned",new RegExp("^(true|false|null|undefined)$"));class E extends w{constructor(t){super();let e=this.constructor.match(t);this.name=e[1]}}u(E,"description","event name");class x extends w{constructor(t){super();let e=this.constructor.match(t);this.var=e[1]}eval(t){return this.value(t)}}u(x,"description","variable");class y extends w{constructor(t){super();let e=this.constructor.match(t);this.var=e[1]}affected(t){return g(t,this.var+".*")}eval(t){return this.value(t)}}u(y,"description","object"),u(y,"regexp",new RegExp("^"+b+"\\.\\*$"));class I extends w{constructor(t){super();let e=this.constructor.match(t);this.var=e[1],this.cmp=e[3],this.val=JSON.parse(e[4].replaceAll("'",'"')),!0!==this.val&&!1!==this.val&&null!==this.val||(this.cmp+="=")}eval(t){let e=this.value(t);if(null==e||Number.isNaN(e))return!1;switch(this.cmp){case"==":return e==this.val;case"!=":return e!=this.val;case"===":return e===this.val;case"!==":return e!==this.val}}}u(I,"description","comparision"),u(I,"regexp",new RegExp("^"+b+" (==|!=) (.+)$"));class T extends w{constructor(t){super();let e=this.constructor.match(t);this.var=e[1],this.val=JSON.parse(e[3].replaceAll("'",'"'))}}function k(t,e){for(let n of e)try{return new n(t)}catch(t){continue}let n=e.map((t=>t.description)).join(" or ");throw new Error('Invalid expression: "'.concat(t,'", expected: ').concat(n))}function A(t){return o(t)||s(t)||e(t)||i(t)}function C(t){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return function*(){if(""!=i&&A(t)&&(yield[i,n(t)?null:t]),r(o=t)||e(o))for(let[e,n]of Object.entries(t))A(n)&&(yield*C(n,i?"".concat(i,".").concat(e):e));var o}()}u(T,"description","assignment"),u(T,"regexp",new RegExp("^"+b+" = (.+)$"));let S=new Map;const L={update(){let t=new Map(C(this));let e=function(t,e){let n=new Map,i=[],o=new Set;for(let e of t.keys())o.add(e);for(let t of e.keys())o.add(t);for(let s of o){if(i.some((t=>m(t,s))))continue;let o=t.get(s),r=e.get(s);r!==o&&(n.set(s,void 0===r?null:r),i.push(s))}return n}(S,t);0!=e.size&&(S=t,l("update",e))}};function _(t,e){c("onEvent",arguments,["string","function"]),document.body.addEventListener("ot.".concat(t),(async t=>{await e(t.detail,t),L.update()}))}function P(t){return 2==t.length?{match:t[0],handler:t[1]}:{match:void 0,handler:t[0]}}function j(){c("onInput",arguments,["string","function"],["function"]);let{handler:t,match:e}=P(arguments);_("input",void 0!==e?n=>{n.name==e&&t(n.value)}:e=>{t(e.name,e.value)})}function U(t,e){try{c("onReset",arguments,["string","function"])}catch(t){throw console.error(t),new Error("Invalid onReset usage")}let i;try{i=k(t,[x,y])}catch(t){throw console.error(t),new Error("Invalid onReset usage")}_("load",(function(){e()})),_("update",(function(t){if(i.affected(t)){n(i.eval(L))&&e()}}))}function M(){try{c("onUpdate",arguments,["string","function"],["function"])}catch(t){throw console.error(t),new Error("Invalid onUpdate usage")}let{handler:t,match:e}=P(arguments);if(void 0!==e){let i;try{i=k(e,[x,y])}catch(t){throw console.error(t),new Error("Invalid onUpdate usage")}_("update",(function(e){if(i.affected(e)){let e=i.eval(L);n(e)||t(e)}}))}else _("update",(function(e){t(e)}))}const O=new Set;function N(){O.forEach((t=>{clearTimeout(t)}))}function z(t){return 2==t.length?{match:t[0],handler:t[1]}:{match:void 0,handler:t[0]}}class R{constructor(){this.source="timer",this.timers={},this.schedule={},this.started=null}now(){return Math.floor(performance.now()-this.started)}emitEvent(t){l("time",{source:this.source,time:this.now(),name:t})}start(t){this.schedule=t;for(let t in this.schedule)this.startTimer(t);this.started=performance.now()}startTimer(t){let e=this.schedule[t];this.timers[t]=window.setTimeout((()=>this.emitEvent(t)),e)}stop(){for(let t in this.schedule)this.stopTimer(t);this.started=null}stopTimer(t){window.clearTimeout(this.timers[t]),delete this.timers[t]}}const D=new R;const F=new class extends R{constructor(){super(),this.source="schedule"}start(t){let e={},n=0;for(let i in t)e[i]=n,n+=t[i];super.start(e)}};const H=new class extends R{constructor(){super(),this.source="clock"}start(t){super.start(t);for(let e in t)this.emitEvent(e)}startTimer(t){let e=this.schedule[t];this.timers[t]=window.setInterval((()=>this.emitEvent(t)),e)}stopTimer(t){window.clearInterval(this.timers[t]),delete this.timers[t]}};function W(){c("onTimer",arguments,["string","function"],["function"]);let{handler:t,match:e}=z(arguments);_("time",void 0!==e?function(n){"timer"==n.source&&n.name==e&&t(n.time)}:function(e){"timer"==e.source&&t(e.name,e.time)})}function $(){c("onClock",arguments,["string","function"],["function"]);let{handler:t,match:e}=z(arguments);_("time",void 0!==e?function(n){"clock"==n.source&&n.name==e&&t(n.time)}:function(e){"clock"==e.source&&t(e.name,e.time)})}function B(){c("onSchedule",arguments,["string","function"],["function"]);let{handler:t,match:e}=z(arguments);_("time",void 0!==e?function(n){"schedule"==n.source&&n.name==e&&t(n.time)}:function(e){"schedule"==e.source&&t(e.name,e.time)})}const J={"ot.load":function(){},"ot.startIteration":null,"ot.startTrial":null,"ot.completeTrial":null},K={"ot.load":"onLoad","ot.startIteration":"onIteration","ot.startTrial":"onTrial","ot.completeTrial":"onComplete"};function Z(t,e){let n=J[e.type];if(!n){let t=K[e.type];throw new Error("Missing ".concat(t," handler"))}n(t,e)}function q(){_("load",Z),_("startIteration",Z),_("startTrial",Z),_("completeTrial",Z)}function V(t){c("onLoad",arguments,["function"]),J["ot.load"]=t}function G(t){c("onIteration",arguments,["function"]),J["ot.startIteration"]=t}function Q(t){c("onTrial",arguments,["function"]),J["ot.startTrial"]=t}function X(t){c("onComplete",arguments,["function"]),J["ot.completeTrial"]=t}function Y(t){return"otree.".concat(t,".beg")}function tt(t){return"otree.".concat(t,".end")}function et(t){return"otree.".concat(t,".measure")}function nt(t){return performance.getEntriesByName(et(t))[0].duration}const it={};function ot(t,e){let n=it[t.type];if(void 0===n)throw new Error("Missing onLive('".concat(t.type,"', function) handler"));n(t.data)}function st(t,e){if(void 0===window.liveSocket)throw new Error("Missing live socket, the page is not live");c("onLive",arguments,["string","function"]),it[t]=e}class rt{constructor(t){this.elem=t;let e=Object.fromEntries(Array.from(this.elem.attributes).map((t=>[t.name,t.value])));try{this.init(e)}catch(t){console.error(t),console.error("Failed to init ".concat(this.constructor.name," at"),this.elem)}try{this.setup()}catch(t){console.error(t),console.error("Failed to setup ".concat(this.constructor.name," at"),this.elem)}this.render()}init(t){throw new Error("Directive miss init(attrs) method")}setup(){throw new Error("Directive miss setup() method")}lock(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:15;return!this.locked&&(this.locked=!0,setTimeout((()=>{this.locked=!1}),t),!0)}render(){this.refresh()}refresh(){}onElemEvent(t,e){this.elem.addEventListener(t,function(n){try{e.call(this,n.detail,n)}catch(e){console.error(e),console.error("Failed to ".concat(t," ").concat(this.constructor.name," at"),this.elem)}}.bind(this))}onPageEvent(t,e){document.body.addEventListener(t,function(n){try{e.call(this,n.detail,n)}catch(e){console.error(e),console.error("Failed to ".concat(t," ").concat(this.constructor.name," at"),this.elem)}}.bind(this))}emitElemEvent(t){let e=new CustomEvent(t,{detail:arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0,bubbles:arguments.length>2&&void 0!==arguments[2]&&arguments[2]});setTimeout((()=>this.elem.dispatchEvent(e)))}}class at extends rt{init(t){}setup(){this.onPageEvent("ot.update",this.onUpdate)}refresh(){n(this.value)?this.elem.removeAttribute(this.attr_name):this.elem.setAttribute(this.attr_name,this.value)}onUpdate(t){this.expr.affected(t)&&(this.value=this.expr.eval(L),this.refresh())}}class ct extends rt{init(t){this.elem.ot_frozen=!1,this.locked=!1}get value(){throw new Error("not implemented")}set value(t){throw new Error("not implemented")}setup(){this.onPageEvent("ot.resetInputs",this.onReset),this.onPageEvent("ot.freezeInputs",this.onFreeze),this.onPageEvent("ot.commitInputs",this.onCommit),this.onElemEvent("ot.commitInput",this.onCommit),this.onElemEvent("ot.toggleInput",this.onToggle),this.onToggle()}toggle(){this.elem.disabled=this.elem.ot_disabled||this.elem.ot_frozen,this.elem.disabled?(this.elem.setAttribute("disabled",""),this.elem.blur()):this.elem.removeAttribute("disabled")}commit(){this.elem.disabled||(l("input",{name:this.name,value:this.value}),f(L,this.name,this.value),L.update())}onReset(){this.value=null,this.elem.ot_frozen=!1,this.toggle()}onFreeze(){this.elem.ot_frozen=!0,this.toggle()}onToggle(){this.toggle()}onCommit(t){t&&t.name!=this.name||this.commit()}}class lt extends rt{init(t){let e=t["ot-click"];if(void 0!==e&&""!==e)throw new Error('Invalid attribute value: "'.concat(e,'", expected: none'))}setup(){this.onElemEvent("click",this.onClick)}onClick(){this.lock()&&(this.elem.disabled||this.emitElemEvent("ot.commitInput"))}}class ut extends ct{setup(){super.setup(),this.elem.name||(this.elem.name=this.name),this.onPageEvent("ot.update",this.onUpdate)}get value(){let t=this.elem.value;return""==t?null:t}set value(t){this.elem.value=n(t)?null:t}onUpdate(t){this.expr.affected(t)&&(this.value=this.expr.value(L))}onReset(){super.onReset(),!this.elem.disabled&&this.elem.hasAttribute("autofocus")&&setTimeout((()=>this.elem.focus()))}}class ht extends ut{init(t){if(super.init(t),this.expr=k(t["ot-input"],[x]),this.name=this.expr.var,"autocommit"in t){if(this.autocommit=""!=t.autocommit?parseInt(t.autocommit):250,Number.isNaN(this.autocommit))throw new Error("Invalid autocommit value, expected empty or number of ms")}else this.autocommit=!1;this.autocommit_timer=null}setup(){super.setup(),this.onElemEvent("keydown",this.onKey),this.autocommit&&this.onElemEvent("input",this.onInput)}toggle(){super.toggle(),this.cancelAutocommit(),!this.elem.disabled&&this.elem.hasAttribute("autofocus")&&setTimeout((()=>this.elem.focus()))}scheduleAutocommit(){this.autocommit_timer=setTimeout((()=>this.commit()),this.autocommit)}cancelAutocommit(){this.autocommit_timer&&clearTimeout(this.autocommit_timer),this.autocommit_timer=null}onKey(t,e){if("Enter"==e.code){if(!this.lock())return;e.preventDefault(),this.commit()}}onInput(){this.cancelAutocommit(),this.scheduleAutocommit()}}const mt=[[class extends rt{init(t){this.expr=k(t["ot-text"],[x]),this.content=""}setup(){this.onPageEvent("ot.update",this.onUpdate)}refresh(){this.elem.innerText=this.content}onUpdate(t){this.expr.affected(t)&&(this.content=this.expr.eval(L),n(this.content)&&(this.content=""),this.refresh())}},"[ot-text]"],[class extends rt{init(t){this.expr=k(t["ot-html"],[x]),this.content=""}setup(){this.onPageEvent("ot.update",this.onUpdate)}refresh(){this.elem.innerHTML=this.content}onUpdate(t){this.expr.affected(t)&&(this.content=this.expr.eval(L),n(this.content)&&(this.content=""),this.refresh())}},"[ot-html]"],[class extends rt{init(t){this.expr=k(t["ot-img"],[x])}setup(){this.onPageEvent("ot.update",this.onUpdate)}render(){}refresh(){for(let t of this.elem.attributes)"src"!=t.name&&this.img.setAttribute(t.name,t.value);this.elem.replaceWith(this.img),this.elem=this.img}onUpdate(t){if(this.expr.affected(t)){if(this.img=this.expr.eval(L),n(this.img)&&(this.img=new Image),!(this.img instanceof HTMLImageElement))throw new Error('Invalid value of "'.concat(this.expr.var,'", expected preloaded HTMLImage, use `ot.loadImage`'));this.refresh()}}},"img[ot-img]"],[class extends rt{init(t){this.expr=k(t["ot-class"],[x]),this.defaults=Array.from(this.elem.classList)}setup(){this.onPageEvent("ot.update",this.onUpdate)}refresh(){this.elem.classList.remove(...this.elem.classList),this.defaults&&this.elem.classList.add(...this.defaults),n(this.value)||this.elem.classList.add(this.value)}onUpdate(t){this.expr.affected(t)&&(this.value=this.expr.eval(L),this.refresh())}},"[ot-class]"],[class extends rt{init(t){this.expr=k(t["ot-if"],[x,I]),this.enabled=!1}setup(){this.onPageEvent("ot.update",this.onUpdate)}refresh(){this.enabled?this.elem.removeAttribute("hidden"):this.elem.setAttribute("hidden","")}onUpdate(t){if(this.expr.affected(t)){let t=this.expr.eval(L);this.expr instanceof x?this.enabled=!n(t):this.enabled=t,this.refresh()}}},"[ot-if]"],[class extends at{init(t){this.attr_name="value",this.expr=k(t["ot-attr-value"],[x])}},"[ot-attr-value]"],[class extends at{init(t){this.attr_name="min",this.expr=k(t["ot-attr-min"],[x])}},"[ot-attr-min]"],[class extends at{init(t){this.attr_name="max",this.expr=k(t["ot-attr-max"],[x])}},"[ot-attr-max]"],[class extends at{init(t){this.attr_name="height",this.expr=k(t["ot-attr-height"],[x])}},"[ot-attr-height]"],[class extends at{init(t){this.attr_name="width",this.expr=k(t["ot-attr-width"],[x])}},"[ot-attr-width]"],[class extends at{init(t){this.attr_name="src",this.expr=k(t["ot-attr-src"],[x])}},"img[ot-attr-src]"],[class extends rt{init(t){this.expr=k(t["ot-enabled"],[x,I]),this.isinput="ot-input"in t,this.enabled=null}setup(){this.onPageEvent("ot.update",this.onUpdate),this.isinput||this.onElemEvent("ot.toggleInput",this.onToggle)}refresh(){this.elem.ot_disabled=!this.enabled,this.emitElemEvent("ot.toggleInput")}onUpdate(t){if(this.expr.affected(t)){let t=this.expr.eval(L);this.expr instanceof x?this.enabled=!n(t):this.enabled=t,this.refresh()}}onToggle(){this.elem.disabled=this.elem.ot_disabled,this.elem.disabled?this.elem.setAttribute("disabled",""):this.elem.removeAttribute("disabled")}},"[ot-enabled]"],[ht,"input[type=text][ot-input]"],[ht,"input[type=number][ot-input]"],[class extends ut{init(t){super.init(t),this.expr=k(t["ot-input"],[T]),this.name=this.expr.var}get value(){return this.elem.checked?this.expr.val:void 0}set value(t){this.elem.checked=t==this.expr.val}setup(){super.setup(),this.onElemEvent("change",this.onChange)}commit(){this.elem.checked&&super.commit()}onChange(){this.commit()}},"input[type=radio][ot-input]"],[class extends ut{init(t){super.init(t),this.expr=k(t["ot-input"],[x]),this.name=this.expr.var}get value(){return this.elem.checked}set value(t){this.elem.checked=Boolean(t)}setup(){super.setup(),this.onElemEvent("change",this.onChange)}onChange(){this.commit()}},"input[type=checkbox][ot-input]"],[class extends ct{init(t){super.init(t),this.expr=k(t["ot-input"],[T]),this.name=this.expr.var}get value(){return this.expr.val}set value(t){}},"[ot-input]:not(input, select)"],[class extends rt{init(t){this.expr=k(t["ot-emit"],[E]),this.name=this.expr.name}setup(){this.onElemEvent("ot.toggleInput",this.onToggle),this.onElemEvent("ot.commitInput",this.onCommit)}toggle(){}onToggle(){this.elem.disabled=this.elem.ot_disabled,this.elem.disabled?this.elem.setAttribute("disabled",""):(this.elem.removeAttribute("disabled"),this.elem.blur())}onCommit(){this.elem.disabled||l(this.name)}},"[ot-emit]"],[class extends rt{init(t){if(this.key=t["ot-key"],1!=this.key.length&&!this.key.match(/[A-Z]\w+/))throw new Error('Invalid attribute value: "'.concat(this.key,'", see "Code values for keyboard" at developer.mozilla.org'))}setup(){this.onPageEvent("keydown",this.onKey)}onKey(t,e){this.lock()&&(this.elem.disabled||this.key!=e.key&&this.key!=e.code||(e.preventDefault(),this.emitElemEvent("ot.commitInput")))}},"[ot-key]"],[lt,"[ot-click]"],[class extends lt{onClick(){this.lock()&&(this.elem.disabled||(this.emitElemEvent("ot.commitInput"),this.elem.blur()))}},"button[type=button]"]];const dt={onLoad:V,onIteration:G,onTrial:Q,onComplete:X},pt={onEvent:_,onInput:j,onReset:U,onUpdate:M,onLive:st,onTimer:W,onClock:$,onSchedule:B};return window.addEventListener("load",(()=>{mt.forEach((t=>{let[e,n]=t;return function(t,e){document.querySelectorAll(e).forEach((e=>new t(e)))}(e,n)})),function(t){for(let e in dt)window[t][e]!==dt[e]&&console.error("Invalid usage of ".concat(e,", expected: ").concat(t,".").concat(e,"(function)"));for(let e in pt)window[t][e]!==pt[e]&&console.error("Invalid usage of ".concat(e,", expected: ").concat(t,".").concat(e,"(function) or ").concat(t,".").concat(e,'("name", function)'))}("ot"),void 0!==window.liveSocket&&(window.liveSocket.onmessage=function(t){let e=JSON.parse(t.data);for(const[t,n]of Object.entries(e))l("live",{type:t,data:n})},_("live",ot)),q(),l("load")})),t.AssignExpr=T,t.CmpExpr=I,t.EventExpr=E,t.Expr=w,t.ObjExpr=y,t.VarExpr=x,t.affecting=g,t.assertArgs=c,t.beginMeasurement=function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"response";!function(t){performance.clearMarks(Y(t)),performance.clearMarks(tt(t)),performance.clearMeasures(et(t))}(t),function(t){performance.mark(Y(t))}(t)},t.cancelDelays=N,t.clock=H,t.commitInputs=function(t){c("commitInputs",arguments,[],["string"]),t?l("commitInputs",{name:t}):l("commitInputs")},t.completePage=function(){c("completePage",arguments,[]),N(),setTimeout((()=>document.querySelector("form#form").submit()),15)},t.completeTrial=function(t){c("completeTrial",arguments,["object"]),l("completeTrial",t)},t.delay=async function(t,e){let n;return c("delay",arguments,["number","function"],["number"]),n=void 0!==e?function(){e(),L.update()}:function(){},new Promise(((e,i)=>{let o=setTimeout((()=>{n(),e()}),t);O.add(o)}))},t.delayEvent=function(t,e,n){c("delayEvent",arguments,["number","string","data"],["number","string"]);let i=new CustomEvent("ot.".concat(e),{detail:n}),o=setTimeout((()=>document.body.dispatchEvent(i)),t);O.add(o)},t.emitEvent=l,t.endMeasurement=function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"response";return function(t){performance.mark(tt(t)),performance.measure(et(t),Y(t),tt(t))}(t),nt(t)},t.freezeInputs=function(){c("freezeInputs",arguments,[]),l("freezeInputs")},t.getMeasurement=function(){return nt(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"response")},t.init=q,t.isArray=e,t.isFunction=function(t){return"function"==typeof t},t.isHTMLElement=i,t.isObject=s,t.isPlainObject=r,t.isScalar=o,t.isVoid=n,t.keypath=v,t.loadImage=function(t){let e;return"string"==typeof t?(e=new Image,e.src=t):t instanceof HTMLImageElement&&(e=t),e.complete?Promise.resolve(e):new Promise(((t,n)=>{e.onload=()=>t(e),e.onerror=n}))},t.onClock=$,t.onComplete=X,t.onEvent=_,t.onInput=j,t.onIteration=G,t.onLive=st,t.onLoad=V,t.onReset=U,t.onSchedule=B,t.onTimeout=function(t){c("onTimeout",arguments,["function"]),_("time",(function(e){"timer"==e.source&&"timeout"==e.name&&t(e.time)}))},t.onTimer=W,t.onTrial=Q,t.onUpdate=M,t.otAttr=at,t.otDirectiveBase=rt,t.otInputBase=ct,t.page=L,t.parseExpr=k,t.registerDirective=function(t,e){mt.push([t,e])},t.resetInputs=function(){c("resetInputs",arguments,[]),l("resetInputs")},t.schedule=F,t.sendLive=function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(void 0===window.liveSocket)throw new Error("Missing live socket, the page is not live");c("sendLive",arguments,["string","object"],["string"]),window.liveSocket.send(JSON.stringify({[t]:e}))},t.startClock=function(t){H.start(t)},t.startIteration=function(t){c("startIteration",arguments,[]),l("startIteration",t)},t.startSchedule=function(t){F.start(t)},t.startTimer=function(t){D.start(t)},t.startTrial=function(t){c("startTrial",arguments,["object"]),l("startTrial",t)},t.stopClock=function(t){void 0!==t?H.stopTimer(t):H.stop()},t.stopSchedule=function(){F.stop()},t.stopTimer=function(t){void 0!==t?D.stopTimer(t):D.stop()},t.timer=D,t}({});
